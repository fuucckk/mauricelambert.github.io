<!DOCTYPE html>
<!--
  Copyright (C) 2025 MauriceLambert

  This file is part of the `K41r0` escape game.

  K41r0 is free software: you can redistribute it and/or modify
  it under the terms of the GNU General Public License as published by
  the Free Software Foundation, either version 3 of the License, or
  (at your option) any later version.

  K41r0 is distributed in the hope that it will be useful,
  but WITHOUT ANY WARRANTY; without even the implied warranty of
  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
  GNU General Public License for more details.

  You should have received a copy of the GNU General Public License
  along with K41r0.  If not, see <https://www.gnu.org/licenses/>.
-->
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hacking Hardware Panel</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap');

  body {
    margin: 0; padding: 20px;
    background-color: #0d0d0d;
    color: #00ff00;
    font-family: 'Share Tech Mono', monospace;
    transition: background-color 0.3s, color 0.3s;
  }
  h1 {
    text-align: center;
    margin-bottom: 30px;
    letter-spacing: 0.1em;
    text-shadow: 0 0 10px #00ff00;
  }

  .thermometer {
    width: 60px;
    height: 250px;
    background: linear-gradient(to top, #222 0%, #555 100%);
    border-radius: 30px;
    margin: 0 auto 40px;
    position: relative;
    box-shadow: 0 0 10px #00ff00;
  }
  .mercury {
    position: absolute;
    bottom: 10px;
    left: 15px;
    width: 30px;
    background: linear-gradient(to top, #ff2400, #ff4500);
    border-radius: 20px 20px 0 0;
    transition: height 0.3s;
  }

  .controls {
    display: flex;
    justify-content: space-around;
    max-width: 900px;
    margin: 0 auto 40px;
    gap: 30px;
  }
  .control {
    background: #111;
    padding: 20px;
    border-radius: 12px;
    box-shadow: 0 0 10px #00ff00;
    flex: 1;
    text-align: center;
  }
  label {
    display: block;
    margin-bottom: 8px;
    font-weight: bold;
  }
  input[type=range] {
    width: 100%;
    cursor: pointer;
  }

  .knob-container {
    position: relative;
    width: 120px;
    height: 120px;
    margin: 0 auto;
  }
  .knob {
    position: absolute;
    top: 0; left: 0; right: 0; bottom: 0;
    margin: auto;
    width: 100px;
    height: 100px;
    background: #222;
    border-radius: 50%;
    border: 3px solid #00ff00;
    box-shadow: 0 0 15px #00ff00 inset;
    cursor: grab;
    transition: box-shadow 0.2s;
  }
  .knob:active {
    cursor: grabbing;
    box-shadow: 0 0 25px #00ff00 inset;
  }
  .knob-indicator {
    width: 8px;
    height: 40px;
    background: #00ff00;
    position: absolute;
    top: 15px;
    left: 50%;
    transform: translateX(-50%);
    border-radius: 3px;
    box-shadow: 0 0 10px #00ff00;
  }

  .vibration-alert {
    position: fixed;
    top: 20px; right: 20px;
    background: #ff0000;
    color: #000;
    padding: 10px 20px;
    font-weight: bold;
    border-radius: 8px;
    box-shadow: 0 0 15px #ff0000;
    display: none;
    z-index: 1000;
    user-select: none;
    font-family: 'Share Tech Mono', monospace;
  }
</style>
</head>
<body>

<div style="display: flex; align-items: center; justify-content: center; position: relative; margin-bottom: 30px;">
  <button id="backButton" style="
    position: absolute;
    left: 0;
    background: transparent;
    border: 2px solid #00ff00;
    color: #00ff00;
    font-family: 'Share Tech Mono', monospace;
    font-size: 1em;
    padding: 6px 12px;
    border-radius: 6px;
    cursor: pointer;
    box-shadow: 0 0 10px #00ff00;
    transition: background-color 0.3s, color 0.3s;
  ">‚Üê Back</button>

  <h1 style="margin: 0 auto; text-shadow: 0 0 10px #00ff00;">HACKING HARDWARE PANEL</h1>
</div>

<div style="display: flex; justify-content: center; align-items: center; gap: 150px; width: max-content; margin: 0 auto; padding: 20px;">
  <div class="thermometer" style="width: 60px; height: 250px; background: linear-gradient(to top, #222 0%, #555 100%); border-radius: 30px; position: relative; box-shadow: 0 0 10px #0f0;">
    <div class="mercury" id="mercury" style="position: absolute; bottom: 10px; left: 15px; width: 30px; height: 50px; background: linear-gradient(to top, #ff2400, #ff4500); border-radius: 20px 20px 0 0; transition: height 0.3s;"></div>
  </div>
  <div style="display: flex; flex-direction: column;">
    <label for="tempInput" style="margin-bottom: 8px;">Set Temperature (¬∞C):</label>
    <input type="number" id="tempInput" min="0" max="100" value="20"
      style="width: 80px; font-family: 'Share Tech Mono', monospace; font-size: 1.2em; background: #000; color: #0f0; border: 1px solid #0f0; border-radius: 5px; padding: 5px;" />
  </div>
</div>

<div class="controls">
  <div class="control">
    <label for="knobValue">Rotary Knob (0-1023)</label>
    <div class="knob-container" id="knobContainer">
      <div class="knob" id="knob">
        <div class="knob-indicator"></div>
      </div>
    </div>
    <div id="knobValue" style="margin-top: 10px; font-size: 1.2em;">0</div>
  </div>

  <div class="control">
    <label for="lightRange">Light Sensor (0-1023)</label>
    <input type="range" id="lightRange" min="0" max="1023" value="0"/>
    <div id="lightValue" style="margin-top: 10px; font-size: 1.2em;">0</div>
  </div>
</div>

<div class="vibration-alert" id="vibrationAlert">VIBRATION ALERT!</div>

<canvas id="fireworksCanvas" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 9999; pointer-events: none; display: none;"></canvas>

<div id="successMessage" style="display: none; position: fixed; top: 40%; width: 100%; text-align: center; color: #0f0; font-size: 2em; font-family: 'Share Tech Mono', monospace; text-shadow: 0 0 10px #0f0; z-index: 9999;">
  ‚úÖ Access granted: Data secured.<br>
  üß® Self-destruct sequence neutralized.
</div>

<script>
  const tempInput = document.getElementById('tempInput');
  const mercury = document.getElementById('mercury');

  function updateThermometer(temp) {
    temp = Math.min(100, Math.max(0, temp));
    const height = 10 + (temp / 100) * 230;
    mercury.style.height = height + 'px';
  }
  tempInput.addEventListener('input', () => {
    updateThermometer(parseFloat(tempInput.value));
    checkVibration('temp', parseFloat(tempInput.value));
  });
  updateThermometer(parseFloat(tempInput.value));

  const knob = document.getElementById('knob');
  const knobContainer = document.getElementById('knobContainer');
  const knobValueDisplay = document.getElementById('knobValue');
  let knobValue = 0;
  let knobAngle = 0;
  let isDragging = false;

  function angleToValue(angle) {
    let val = ((angle + 135) / 270) * 1023;
    val = Math.min(1023, Math.max(0, val));
    return Math.round(val);
  }

  function valueToAngle(value) {
    return (value / 1023) * 270 - 135;
  }

  function rotateKnob(angle) {
    knob.style.transform = `rotate(${angle}deg)`;
  }

  knob.addEventListener('mousedown', (e) => {
    e.preventDefault();
    isDragging = true;
  });
  document.addEventListener('mouseup', () => {
    isDragging = false;
  });
  document.addEventListener('mousemove', (e) => {
    if (!isDragging) return;

    const rect = knobContainer.getBoundingClientRect();
    const centerX = rect.left + rect.width / 2;
    const centerY = rect.top + rect.height / 2;

    const dx = e.clientX - centerX;
    const dy = e.clientY - centerY;
    let angle = Math.atan2(dy, dx) * (180 / Math.PI);

    angle = Math.min(135, Math.max(-135, angle));
    rotateKnob(angle);

    knobValue = angleToValue(angle);
    knobValueDisplay.textContent = knobValue;
    checkVibration('knob', knobValue);
    checkUnlockCondition();
  });

  const lightRange = document.getElementById('lightRange');
  const lightValueDisplay = document.getElementById('lightValue');

  function updateLight(value) {
    value = Math.min(1023, Math.max(0, value));
    lightValueDisplay.textContent = value;
    const ratio = value / 1023;
    const bgColor = interpolateColor([13,13,13], [224,255,224], ratio);
    const textColor = interpolateColor([0,255,0], [0,80,0], ratio);
    document.body.style.backgroundColor = `rgb(${bgColor.join(',')})`;
    document.body.style.color = `rgb(${textColor.join(',')})`;
  }

  lightRange.addEventListener('input', () => {
    updateLight(parseInt(lightRange.value));
    checkVibration('light', parseInt(lightRange.value));
  });
  updateLight(parseInt(lightRange.value));

  function interpolateColor(rgb1, rgb2, ratio) {
    return rgb1.map((c, i) => Math.round(c + (rgb2[i] - c) * ratio));
  }

  const vibrationAlert = document.getElementById('vibrationAlert');
  let lastValues = { temp: parseFloat(tempInput.value), knob: knobValue, light: parseInt(lightRange.value) };
  let lastTime = Date.now();
  let vibrationTimeout;
  let counter = 0;

  function checkVibration(sensor, newValue) {
    const now = Date.now();
    const deltaTime = now - lastTime;
    const deltaValue = Math.abs(newValue - lastValues[sensor]);

    if (sensor === 'temp') {
      if (deltaTime < 500 && (deltaValue > 10 || counter > 10)) {
        triggerVibration();
      } else if (deltaTime > 500) {
        counter = 0;
      } else if (deltaTime < 500) {
        counter += 1;
      }
    } else if(deltaTime < 300 && deltaValue > 50) {
      triggerVibration();
    }
    lastValues[sensor] = newValue;
    lastTime = now;
  }

  function triggerVibration() {
    if (vibrationTimeout) return;
    lightRange.value = 0;
    updateLight(0);
    knobValue = 0;
    rotateKnob(knobValue);
    knobValueDisplay.textContent = knobValue;
    
    vibrationAlert.style.display = 'block';

    document.body.style.animation = 'vibrate 0.5s linear';

    setTimeout(() => {
      vibrationAlert.style.display = 'none';
      document.body.style.animation = '';
      vibrationTimeout = null;
    }, 1500);
    vibrationTimeout = true;
  }

  const styleSheet = document.createElement('style');
  styleSheet.type = 'text/css';
  styleSheet.innerText = `
    @keyframes vibrate {
      0% { transform: translate(0); }
      20% { transform: translate(-2px, 2px); }
      40% { transform: translate(-2px, -2px); }
      60% { transform: translate(2px, 2px); }
      80% { transform: translate(2px, -2px); }
      100% { transform: translate(0); }
    }
  `;
  document.head.appendChild(styleSheet);

  document.getElementById('backButton').addEventListener('click', () => {
    history.back();
  });

const targetTemp = 37;
const targetPot = 956;
const targetLight = 283;

let currentTemp = 0;

function checkUnlockCondition() {
  if (currentTemp == targetTemp && knobValue == targetPot && lightRange.value == targetLight) {
    triggerCelebration();
  }
}

function triggerCelebration() {
  document.getElementById("successMessage").style.display = "block";
  const canvas = document.getElementById("fireworksCanvas");
  canvas.style.display = "block";
  const ctx = canvas.getContext("2d");
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;

  let particles = [];

  function createFirework() {
    const x = Math.random() * canvas.width;
    const y = Math.random() * canvas.height / 2;
    const color = 'hsl(' + Math.random() * 360 + ', 100%, 50%)';
    for (let i = 0; i < 100; i++) {
      particles.push({
        x, y,
        dx: (Math.random() - 0.5) * 5,
        dy: (Math.random() - 0.5) * 5,
        color,
        life: 100
      });
    }
  }

  function animate() {
    ctx.fillStyle = "rgba(0, 0, 0, 0.2)";
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    particles.forEach((p, i) => {
      p.x += p.dx;
      p.y += p.dy;
      p.life--;
      ctx.fillStyle = p.color;
      ctx.fillRect(p.x, p.y, 2, 2);
      if (p.life <= 0) particles.splice(i, 1);
    });
    requestAnimationFrame(animate);
  }

  setInterval(createFirework, 500);
  animate();
}

document.getElementById("tempInput").addEventListener("input", e => {
  currentTemp = parseInt(e.target.value);
  checkUnlockCondition();
});

document.getElementById("lightRange").addEventListener("input", e => {
  checkUnlockCondition();
});
</script>

</body>
</html>
